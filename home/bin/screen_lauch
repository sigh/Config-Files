#!/usr/bin/python

from __future__ import print_function

import argparse
import getopt
import os
import subprocess
import sys

DEFAULT_SESSION_NAME = '_'

def run_screen(session_name = None,
               reattach = False,
               fork = False,
               window = None):

    if session_name is None:
        session_name = DEFAULT_SESSION_NAME

    args = ['screen']
    if window is not None:
        args.extend(['-p', window])
    if reattach:
        args.extend(['-x', '-S'])
    else:
        args.extend(['-D', '-R'])
    args.append(session_name)

    if fork:
        subprocess.call(args)
    else:
        os.execvp(args[0], args)

def main():
    parser = argparse.ArgumentParser(description = 'Launch screen')
    parser.add_argument(
        '--reattach', '-r',
        action = 'store_false',
        help = "Reattach session (don't close existing sessions)")
    parser.add_argument(
        '--fork', '-f',
        action = 'store_false',
        help = "Fork screen, don't exec")
    parser.add_argument(
        '--window', '-p',
        help = "Open to given window")
    parser.add_argument(
        'session_name',
        type = str,
        nargs = '?',
        help = 'Name of the session')

    run_screen(**vars(parser.parse_args()))

if __name__ == '__main__':
    main()
